# Design Document 

Authors: Team 48

Date: 23/04/2022

Version: 0.1


# Contents

- [High level design](#package-diagram)
- [Low level design](#class-diagram)
- [Verification traceability matrix](#verification-traceability-matrix)
- [Verification sequence diagrams](#verification-sequence-diagrams)


# Instructions

The design must satisfy the Official Requirements document, notably functional and non functional requirements, and be consistent with the APIs


# High level design

The architectural pattern selected is the client - server model. Clients can be smartphones, tablets, PCs.

The choice is to avoid any development client side. The clients will access the server only through a browser, using a device.

The server has two components:
- The frontend: is developed with web technologies (JavaScript, HTML, Css) and is in charge of collecting user inputs to send requests to the backend;
- The backend: is developed using node.js, exposes API to the front-end.

Together, they implement a layered style: Presentation layer (front end), Application logic and data layer (back end).

Together, they implement also an MVC pattern, with the V on the front end and the MC on the back end.

## Front End

The Frontend component is made of:
- Views: the package contains the .html pages that are rendered on the browser and that provide the GUI to the user.
- Styles: the package contains .css style sheets that are used to render the GUI. We could also use Bootstrap Framework.
- Controller: the package contains the JavaScript files that catch the user's inputs. Based on the user's inputs and on the status of the GUI widgets, the JavaScript controller creates REST API calls that are sent to the Controller implemented in the back-end.

## Back End

The backend  uses a MC style, combined with a layered style (application logic, data).

The back end is implemented using node.js developing applications.
- Data: the package is used for managing and processing data (implementing the main "Model" part of the MVC architectural pattern);
- Controller: this package is in charge of handling the calls to the REST API that are generated by the user's interaction with the GUI. The Controller package contains methods in 1:1 correspondance to the REST API calls.


# Low level design

## Notes on the class diagram

For the purpose of achieving better visual clarity the following changes have been made
- the diagram has been broken in two parts and the components have been isolated
- the connections between the components and the respective DAO, service and router has been omitted
- trivial getters and setters have not been included

```plantuml
class server

package routers {
    class SKU_router
    class SKUItem_router
    class Position_router
    class TestDescriptor_router
    class TestResult_router
    class User_router
    class RestockOrder_router
    class ReturnOrder_router
    class InternalOrder_router
    class Item_router
}

package services {
	class SKU_service {
		- sku_DAO : SKU_DAO
		- testDescriptor_DAO : TestDescriptor_DAO
		- position_DAO : Position_DAO
		__
		+ constructor(sku_DAO : SKU_DAO, testDescriptor_DAO : TestDescriptor_DAO, position_DAO : Position_DAO)
		+ getSKUs() : {status: Integer, body: Object}
		+ getSKUbyId(id : Integer) : {status: Integer, body: Object}
		+ createSKU(description : String, weight : Float, volume : Float, notes : String, price : Float, quantity : Integer) : {status: Integer, body: Object}
		+ updateSKU(id : Integer, positionId : String, newDescription : String, newWeight : Float, newVolume : Float, newNotes : String, newPrice : Float, newAvailableQuantity : Integer) : {status: Integer, body: Object}
		+ deleteSKU(id : Integer) : Promise
	}
	class SKUItem_service {
		- skuItem_DAO : SKUItem_DAO
		- sku_DAO : SKU_DAO
		__
		+ constructor(skuItem_DAO : SKUItem_DAO, sku_DAO : SKU_DAO)
		+ getSKUItems() : Promise<Array<SKUItem>>
		+ getSKUItemsBySKUID(skuid : Integer) : {status: Integer, body: Object}
		+ getSKUItemByRFID(rfid : String) : Promise<SKUItem>
		+ createSKUItem(rfid : String, skuid : Integer, dateOfStock : String) : {status: Integer, body: Object}
		+ updateSKUItem(rfid : String, newRFID : String, newAvailable : Integer, newDateOfStock : String) : {status: Integer, body: Object}
		+ deleteSKUItem(rfid : String) : Promise
	}
	class Position_service {
		- position_DAO : Position_DAO
		__
		+ constructor(position_DAO : Position_DAO)
		+ getPositions() : Promise<Array<Position>>
		+ createPosition(positionID : String, aisleID : String, row : String, col : String, maxWeight : Float, maxVolume : Float) : {status: Integer, body: Object}
		+ updatePosition(posID : String, newPositionID : String, newAisleID : String, newRow : String, newCol : String, newMaxWeight : Float, newMaxVolume : Float, newOccupiedWeight : Float, newOccupiedVolume : Float) : {status: Integer, body: Object}
		+ deletePosition(posID : String) : Promise
	}
	class TestDescriptor_service {
		- testDescriptor_DAO : TestDescriptor_DAO
		- sku_DAO : SKU_DAO
		__
		+ constructor(testDescriptor_DAO : TestDescriptor_DAO, sku_DAO : SKU_DAO)
		+ getTestDescriptors() : Promise<Array<TestDescripto>>
		+ getTestDescriptorByID(id : Integer) : Promise<TestDescriptor>
		+ createTestDescriptor(name : String, procedureDescription : String, idSKU : Integer) : {status: Integer, body: Object}
		+ updateTestDescriptor(id : Integer,  : String, newProcedureDescription : String, newIdSKU : Integer) : {status: Integer, body: Object}
		+ deleteTestDescriptor(id : Integer) : Promise
	}
	class TestResult_service {
		- testResult_DAO : TestResult_DAO
		- testDescriptor_DAO : TestDescriptor_DAO
		- skuItem_DAO : SKUItem_DAO
		__
		+ constructor(testResult_DAO : TestResult_DAO, testDescriptor_DAO : TestDescriptor_DAO, skuItem_DAO : SKUItem_DAO)
		+ getTestResults(rfid : String) : {status: Integer, body: Object}
		+ getTestResultByID(rfid : String, id : Integer) : {status: Integer, body: Object}
		+ createTestResult(rfid : String, idTestDescriptor : Integer, date : String, result : Boolean) : {status: Integer, body: Object}
		+ updateTestResult(rfid : String, id : Integer, newIdTestDescriptor : Integer, newDate : String, newResult : Boolean) : {status: Integer, body: Object}
		+ deleteTestResult(rfid : String, id : Integer) : Promise
	}
	class User_service {
		- user_DAO : User_DAO
		__
		+ constructor(user_DAO : User_DAO)
		+ getCurrentUser() : Object
		+ getUsers() : Promise<Array<User>>
		+ getUsersByRole(role : String) : Promise<Array<User>>
		+ createUser(email : String, name : String, surname : String, password : String, type : String) : {status: Integer, body: Object}
		+ session(email : String, password : String, role : String) : {status: Integer, body: Object}
		+ logout() : void
		+ updateUserRights(email : String, oldType : String, newType : String) : {status: Integer, body: Object}
		+ deleteUser(email : String, type : String) : {status: Integer, body: Object}
	}
	class RestockOrder_service {
		- restockOrder_DAO : RestockOrder_DAO
		__
		+ constructor(restockOrder_DAO : RestockOrder_DAO)
		+ getRestockOrders() : Promise<Array<RestockOrder>>
		+ getRestockOrdersByState(state : String) : Promise<Array<RestockOrder>>
		+ getRestockOrderByID(id : Integer) : Promise<RestockOrder>
		+ getRestockOrderByIDReturnItems(id : Integer)  : {status: Integer, body: Object}
		+ createRestockOrder(issueDate : String, supplierId : Integer, products : Array<Object>) : {status: Integer, body: Object}
		+ updateRestockOrderState(id : Integer, newState : String) : {status: Integer, body: Object}
		+ addSkuItemsToRestockOrder(id : Integer, skuItems : Array<Object>) : {status: Integer, body: Object}
		+ updateRestockOrderTransportNote(id : Integer, deliveryDate : String) : {status: Integer, body: Object}
		+ deleteRestockOrder(id : Integer) : Promise
	}
	class ReturnOrder_service {
		- returnOrder_DAO : ReturnOrder_DAO
		- restockOrder_DAO : RestockOrder_DAO
		__
		+ constructor(returnOrder_DAO : ReturnOrder_DAO, restockOrder_DAO : RestockOrder_DAO)
		+ getReturnOrders() : Promise<Array<ReturnOrder>>
		+ getReturnOrderByID(id : Integer) : Promise<ReturnOrder>
		+ newReturnOrder(returnDate : String, products : Array<Object>, restockOrderId : Integer) : {status: Integer, body: Object}
		+ deleteReturnOrder(id : Integer) : Promise
	}
	class InternalOrder_service {
		- internalOrder_DAO : InternalOrder_DAO
		__
		+ constructor(internalOrder_DAO : InternalOrder_DAO)
		+ getInternalOrders() : Promise<Array<InternalOrder>>
		+ getInternalOrdersByState(state : String) : Promise<Array<InternalOrder>>
		+ getInternalOrderByID(id : Integer) : Promise<InternalOrder>
		+ newInternalOrder(issueDate : String, customerId : Integer, products : Array<Object>) : {status: Integer, body: Object}
		+ updateInternalOrder(id : Integer, newState : String, products : Array<Object>) : {status: Integer, body: Object}
		+ deleteInternalOrder(id : Integer) : Promise
	}
	class Item_service {
		- item_DAO : Item_DAO
		- sku_DAO : SKU_DAO
		__
		+ constructor(item_DAO : Item_DAO, sku_DAO : SKU_DAO)
		+ getItems() : Promise<Array<Item>>
		+ getItemByID(id : Integer) : Promise<Item>
		+ createItem(id : Integer, description : String, price : Float, skuid : Integer, supplierId : Integer) : {status: Integer, body: Object}
		+ updateItem(id : Integer, description : String, price : Float) : {status: Integer, body: Object}
		+ deleteItem(id : Integer) : Promise
	}
}

package database {
	class DatabaseConnection {
		- db : sqlite3.Database
		__
		+ createTables() : void
		+ resetTable(tableName : String) : Promise
		+ resetAllTables() : Promise
	}
	class SKU_DAO {
		- db : DatabaseConnection
		__
		+ selectSKUs() : Promise<Array<SKU>>
		+ selectSKUbyID(id : Integer) : Promise<SKU>
		+ insertSKU(newSKU : SKU) : Promise
		+ updateSKU(newSKU : SKU) : Promise
		+ deleteSKU(SKUid : Integer) : Promise
		+ deleteSKUData() : Promise
		+ checkIfPositionOccupie(positionID :  String) : Promise
	}
	class SKUItem_DAO {
		- db : DatabaseConnection
		__
		+ selectSKUItems() : Promise
		+ selectSKUItemByRFID(rfid : String) : Promise<Array<SKUItem>>
		+ selectSKUItemBySKUID(skuid : Integer) : Promise<SKUItem>
		+ insertSKUItem(newSKUItem : SKUItem) : Promise
		+ updateSKUItem(rfid : String, newSKUItem : SKUItem) : Promise
		+ deleteSKUItem(RFID : String) : Promise
		+ deleteSKUItemData() : Promise
	}
	class Position_DAO {
		- db : DatabaseConnection
		__
		+ selectPositions() : Promise<Array<Position>>
		+ selectPositionByID(id : String) : Promise<Position>
		+ insertPosition(newPosition : Position) : Promise
		+ updatePosition(oldPosID : String, newPosition : Position) : Promise
		+ deletePosition(posID : String) : Promise
		+ deletePositionData() : Promise
	}
	class TestDescriptor_DAO {
		- db : DatabaseConnection
		__
		+ selectTestDescriptors() : Promise<Array<TestDescriptor>>
		+ selectTestDescriptorByID(id : Integer) : Promise<TestDescriptor>
		+ selectTestDescriptorsIDBySKUID(skuid : Integer) : Promise<Array<TestDescriptors>>
		+ insertTestDescriptor(testDescriptor : TestDescriptor) : Promise
		+ updateTestDescriptor(testDescriptor : TestDescriptor) : Promise
		+ deleteTestDescriptorByID(id : Integer) : Promise
		+ deleteTestDescriptorData() : Promise
	}
	class TestResult_DAO {
		- db : DatabaseConnection
		__
		+ selectTestResults(rfid : String) : Promise<Array<TestResult>>
		+ selectTestResultByID(rfid : String, id : Integer) : Promise<TestResult>
		+ insertTestResult(testResult : TestResult) : Promise
		+ updateTestResult(testResult : TestResult) : Promise
		+ deleteTestResultByID(rfid : String, id : Integer) : Promise
		+ deleteTestResultData() : Promise
	}
	class Item_DAO {
		- db : DatabaseConnection
		__
		+ selectItems() : Promise<Array<Item>>
		+ selectItemByID(id : String) : Promise<item>
		+ selectItemBySKUID(skuid : Integer) : Promise<item>
		+ insertItem(item : Item) : Promise
		+ updateItem(item : Item) : Promise
		+ deleteItemByID(id : String) : Promise
		+ deleteItemData() : Promise
	}
	class RestockOrder_DAO {
		- db : DatabaseConnection
		__
		+ selectProductsIntoRestockOrder(restockOrder : RestockOrder) : Promise<RestockOrder>
		+ selectSKUItemsIntoRestockOrder(restockOrder : RestockOrder) : Promise<RestockOrder>
		+ selectRestockOrders() : Promise<Array<RestockOrder>>
		+ selectRestockOrdersByState(state : String) : Promise<Array<RestockOrder>>
		+ selectRestockOrderByID(id : Integer) : Promise<RestockOrder>
		+ selectRestockOrderByIDReturnItems(id : Integer) : Promise<RestockOrder>
		+ insertRestockOrder(restockOrder : RestockOrder) : Promise
		+ insertRestockOrderSKUItems(roid : Integer, skuItems : Array<SKUItem>)
		+ updateRestockOrder(restockOrder : RestockOrder) : Promise
		+ deleteRestockOrder(id : Integer) : Promise
		+ deleteRestockOrderData() : Promise
	}
	class ReturnOrder_DAO {
		- db : DatabaseConnection
		__
		+ selectProductsIntoReturnOrder(returnOrder : ReturnOrder) : Promise<ReturnOrder>
		+ selectReturnOrders() : Promise<Array<ReturnOrder>>
		+ selectReturnOrderByID(returnOrderId : Integer) : Promise<ReturnOrder>
		+ insertReturnOrder(returnOrder : ReturnOrder) : Promise
		+ deleteReturnOrder(returnOrderId : Integer) : Promise
	}
	class InternalOrder_DAO {
		- db : DatabaseConnection
		__
		+ selectProductsIntoInternalOrder(internalOrder : InternalOrder) : Promise<InternalOrder>
		+ selectInternalOrders() : Promise<Array<InternalOrder>>
		+ selectInternalOrdersByState(state : String) : Promise<Array<InternalOrder>>
		+ selectInternalOrderByID(id : Integer) : Promise<InternalOrder>
		+ insertInternalOrder(internalOrder : InternalOrder) : Promise
		+ updateInternalOrder(internalOrder : InternalOrder) : Promise
		+ updateInternalOrderProducts(internalOrder : InternalOrder) : Promise
		+ deleteInternalOrder(id : Integer) : Promise
	}
	class User_DAO {
		- db : DatabaseConnection
		__
		+ selectUsers() : Promise<Array<User>>
		+ selectUserByEmailAndType(email : String, type : String) : Promise<User>
		+ insertUser(user : Users) : Promise
		+ updateUser(user : User) : Promise
		+ deleteUserByID(id : Integer) : Promise
		+ deleteUserData() : Promise
	}
}

server -- SKU_router
server -- SKUItem_router
server -- Position_router
server -- TestDescriptor_router
server -- TestResult_router
server -- User_router
server -- RestockOrder_router
server -- ReturnOrder_router
server -- InternalOrder_router
server -- Item_router

SKU_router -- SKU_service
SKUItem_router -- SKUItem_service
Position_router -- Position_service
TestDescriptor_router -- TestDescriptor_service
TestResult_router -- TestResult_service
User_router -- User_service
RestockOrder_router -- RestockOrder_service
ReturnOrder_router -- ReturnOrder_service
InternalOrder_router -- InternalOrder_service
Item_router -- Item_service

SKU_service -- SKU_DAO
SKU_service -- TestDescriptor_DAO
SKU_service -- Position_DAO
SKUItem_service -- SKUItem_DAO
SKUItem_service -- SKU_DAO
Position_service -- Position_DAO
TestDescriptor_service -- TestDescriptor_DAO
TestDescriptor_service -- SKU_DAO
TestResult_service -- TestResult_DAO
TestResult_service -- TestDescriptor_DAO
TestResult_service -- SKUItem_DAO
User_service -- User_DAO
RestockOrder_service -- RestockOrder_DAO
ReturnOrder_service -- ReturnOrder_DAO
ReturnOrder_service -- RestockOrder_DAO
InternalOrder_service -- InternalOrder_DAO
Item_service -- Item_DAO
Item_service -- SKU_DAO

SKU_DAO -- DatabaseConnection
SKUItem_DAO -- DatabaseConnection
Position_DAO -- DatabaseConnection
TestDescriptor_DAO -- DatabaseConnection
TestResult_DAO -- DatabaseConnection
User_DAO -- DatabaseConnection
RestockOrder_DAO -- DatabaseConnection
ReturnOrder_DAO -- DatabaseConnection
InternalOrder_DAO -- DatabaseConnection
Item_DAO -- DatabaseConnection
```

```plantuml
left to right direction

package components {
	class SKU {
		- id
		- description
		- weight
		- volume
		- price
		- notes
		- availableQuantity
		- position
		- testDescriptors
		- itemsID
	}
	class SKUItem {
		- RFID
		- SKUID
		- available
		- dateOfStock
		- testResults
	}
	class Item {
		- id
		- description
		- price
		- SKUID
		- supplierId
	}
	class Position {
		- positionID
		- aisleID
		- row
		- col
		- maxWeight
		- maxVolume
		- occupiedWeight
		- occupiedVolume
	}
	enum UserRole {
		+ administrator
		+ manager
		+ clerk
		+ qualityEmployee
		+ deliveryEmployee
		+ customer
		+ supplier
	}
	class User {
		- id
		- name
		- surname
		- email
		- passwordHash
		- passwordSalt
		- role
		__
		+ checkPassword(password : String) : Boolean
	}
	enum RestockOrderState {
		+ ISSUED
		+ DELIVERY
		+ DELIVERED
		+ TESTED
		+ COMPLETEDRETURN
		+ COMPLETED
	}
	class RestockOrder {
		- id
		- issueDate
		- state
		- supplierId
		- deliveryDate
		- products
		- skuItems
		__
		+ addSKUItems(skuItems : Array<Object>) : void
	}
	class ReturnOrder {
		- id
		- returnDate
		- restockOrderId
		- products
	}
	enum InternalOrderState {
		+ ISSUED
		+ ACCEPTED
		+ REFUSED
		+ CANCELED
		+ COMPLETED
	}
	class InternalOrder {
		- id
		- issueDate
		- state
		- customerId
		- products
		__
		+ assignRFIDs(rfids : Array<Object>) : void
	}
	class TestDescriptor {
		- id
		- name
		- procedureDescription
		- idSKU
	}
	class TestResult {
		- id
		- idTestDescriptor
		- date
		- result
		- rfid
	}
}


SKU -- Position
SKU "*" -- "*" TestDescriptor

SKUItem "*" -- SKU
SKUItem "*" -- "0..1" Position

Item "*" -- SKU

TestDescriptor "1" -- "*" TestResult

TestResult "*" -- SKUItem

RestockOrder -- RestockOrderState
RestockOrder "*" -- "*" Item
RestockOrder -- "*" SKUItem

ReturnOrder "0..1" -- "*" SKUItem
ReturnOrder "0..1" -- RestockOrder

InternalOrder -- InternalOrderState
InternalOrder -- "*" SKUItem
InternalOrder "*" -- "*" SKU
InternalOrder "*" -- User

User -- UserRole
```


# Verification traceability matrix

|       | EzWh | Warehouse | DatabaseHelper | SKU | SKUItem | Item | Supplier | Position | RestockOrder | ReturnOrder | InternalOrder | TransportNote | TestDescriptor | TestResult | User | UserSession |
|:-----:|:----:|:---------:|:--------------:|:---:|:-------:|:----:|:--------:|:--------:|:------------:|:-----------:|:-------------:|:-------------:|:--------------:|:----------:|:----:|:-----------:|
| FR1   | x    | x         | x              |     |         |      |          |          |              |             |               |               |                |            | x    | x           |
| FR2   | x    | x         | x              | x   | x       |      |          |          |              |             |               |               |                |            |      |             |
| FR3.1 | x    | x         | x              | x   | x       |      |          | x        |              |             |               |               |                |            |      |             |
| FR3.2 | x    | x         | x              | x   | x       |      |          |          |              |             |               |               | x              | x          |      |             |
| FR4   | x    | x         | x              |     |         |      |          |          |              |             |               |               |                |            | x    |             |
| FR5   | x    | x         | x              |     | x       |      |          |          | x            |             |               | x             |                |            |      |             |
| FR5.9 | x    | x         | x              |     | x       |      |          |          |              | x           |               |               |                |            |      |             |
| FR6   | x    | x         | x              | x   | x       |      |          |          |              |             | x             |               |                |            |      |             |
| FR7   | x    | x         | x              |     |         | x    | x        |          |              |             |               |               |                |            |      |             |

# Verification sequence diagrams

## Scenario 1.1 - Create SKU S

```plantuml
actor       Manager       as m
participant ":EzWH" as ez
participant ":WareHouse" as wh
participant    ":Database"    as db
alt Valid Data
  m->ez:select positionID
  activate ez
    ez -> wh : createSKU(description, weight, volume, notes)
    activate wh
    group Confirm SKU Creation [confirm Data]
    wh --> ez : [Yes] confirm Data
        wh -> db: addSKU(Object)
        activate db
        db --> wh: void
        deactivate db
    else discard Data
    wh --> ez : [No] confirm Data
    deactivate wh
  ez-->m:void
  deactivate ez
end
else Invalid Data
ez-->m : throw InvalidDataError
end
```

## Scenario 2.1 - Create position

```plantuml
actor       Manager       as m
participant ":EzWH" as ez
participant ":WareHouse" as wh
participant    ":Database"    as db
alt Valid Data
  m->ez:select positionID
  activate ez
    ez -> wh : createPosition(aise ID, row, column, positionID, maxWeight, maxVolume)
    activate wh
    group Confirm Deletion [confirm Create]
    wh --> ez : [Yes] confirm Create
        wh -> db: addPosition(positionID)
        activate db
        db --> wh: void
        deactivate db
    else discard Create
    wh --> ez : [No] confirm Create
    deactivate wh
  ez-->m:void
  deactivate ez
end
else Invalid Data
ez-->m : throw InvalidDataError
end
```

## Scenario 2.5 - Delete position P

```plantuml
actor       Manager       as m
participant ":EzWH" as ez
participant ":WareHouse" as wh
participant    ":Database"    as db
alt Valid Data
  m->ez:select positionID
  activate ez
    ez -> wh : deletePosition(positionID)
    activate wh
    group Confirm Deletion [confirm Delete]
    wh --> ez : [Yes] confirm Delete
        wh -> db: removePosition(positionID)
        activate db
        db --> wh: void
        deactivate db
    else discard Delete
    wh --> ez : [No] confirm Delete
    deactivate wh
  ez-->m:void
  deactivate ez
end
else Invalid Data
ez-->m : throw InvalidDataError
end
```

## Scenario 3.1 - Restock Order of SKU S issued by quantity

```plantuml
actor       Manager            as m
participant ":EzWh"         as ez
participant ":Warehouse"    as wh
participant ":DatabaseHelper"   as db
alt valid Data
m -> ez: create Restock Order
activate ez
ez -> wh: addItemToRestockOrder(restockOrderId, itemId, quantity)
activate wh
ez -> wh : setSupplier(supplierID)
group Confirm Data [confirm Order]
    wh --> ez : [Yes] confirm Data
        wh -> db: storeRestockOrder(Object)
        activate db
        db --> wh: void
        deactivate db
    else discard Order
    wh --> ez : [No] confirm Data
    deactivate wh
end
ez --> m: void
else Invalid Data
ez-->m : throw InvalidDataError
end
```

## Scenario 4.1 - Create user and define rights

```plantuml
actor       Administrator   as admin
participant ":EzWh"         as ezwh
participant ":Warehouse"    as wh
participant ":User"         as user
participant ":DatabaseHelper"   as db

admin -> ezwh: Selects userID id, name n, surname s, email e, password p, role, r
activate ezwh
ezwh -> wh: getUserbyId(id)
activate wh
wh -> db: loadUser()
activate db
db --> wh: users : Map <String,User>
deactivate db
wh --> ezwh : user : User
deactivate wh
alt User doesn't exist
    ezwh -> wh: createUser(id, n, s, e, p, r)
    activate wh
    wh -> user: new User(id, n, s, e, p, r)
    activate user
    user --> wh: newUser : User
    deactivate user
    wh -> db: storeUser(newuser)
    activate db
    db --> wh: void
    deactivate db
    wh --> ezwh: void
    deactivate wh
    ezwh --> admin: Integer
    deactivate ezwh
else User already exists
    ezwh --> admin: throws UserAlreadyExist
    end
```

## Scenario 4.3 - Delete user

```plantuml
actor       Administrator   as admin
participant ":EzWh"         as ezwh
participant ":Warehouse"    as wh
participant ":DatabaseHelper"   as db

admin -> ezwh: Selects userID id
activate ezwh
ezwh -> wh: deleteUser(id)
activate wh
wh -> db: removeUser(id)
activate db
db --> wh: void
deactivate db
wh --> ezwh : void
deactivate wh
ezwh --> admin: Integer
deactivate ezwh
```

## Scenario 5.1.1 - Record restock order arrival

```plantuml
actor Clerk
participant EzWh
note over EzWh: Includes GUI and API interface
participant Warehouse
participant SKUItem
participant RestockOrder

Clerk -> EzWh : Selects RestockOrder RO and a List of SKU S and RFID R
EzWh -> Warehouse : addSKUItemToRestockOrder(RO, S, R)
activate Warehouse
Warehouse -> SKUItem: new SKUItem(S, R)
activate SKUItem
SKUItem --> Warehouse : SKUItem SI
deactivate SKUItem
Warehouse -> Warehouse :getRestockOrderById(RO)
Warehouse -> RestockOrder : setSKUItems(List<SI>)
activate RestockOrder
RestockOrder --> Warehouse : Done
deactivate RestockOrder
Warehouse -> Warehouse : updateRestockOrderState(RO, DELIVERED)
Warehouse --> EzWh : Done
deactivate Warehouse
EzWh --> Clerk : Done
```

## Scenario 5.2.1 - Record positive test results of all SKU items of a RestockOrder

```plantuml
actor QualityEmployee as QE
participant EzWh
note over EzWh: Includes GUI and API interface
participant Warehouse
participant TestResult
participant SKUItem
participant RestockOrder

QE -> EzWh : Selects Restock Order ROID, positive esit for all test results,\nDate D, RFID List RL, Test Descriptor IDs T
activate EzWh
EzWh -> Warehouse : for R in RL do createTestResult(R, T, D, TRUE)
activate Warehouse
Warehouse -> Warehouse : generate TestResult ID TRID
Warehouse -> TestResult : new TestResult(TRID, T, D, TRUE)
activate TestResult
TestResult --> Warehouse : TestResult TR
deactivate TestResult
Warehouse -> Warehouse : getSKUItemByRFID(R)
Warehouse -> SKUItem : addTestResults(TR)
activate SKUItem
SKUItem --> Warehouse : Done
deactivate SKUItem
Warehouse --> EzWh : Done
deactivate Warehouse

EzWh -> Warehouse : updateRestockOrderState(ROID, TESTED)
activate Warehouse
Warehouse -> Warehouse : getRestockOrderById(ROID)
Warehouse -> RestockOrder : setState(TESTED)
activate RestockOrder
RestockOrder --> Warehouse : Done
deactivate RestockOrder
Warehouse --> EzWh : Done
deactivate Warehouse
EzWh --> QE : Done
deactivate EzWh
```

## Scenario 5.3.1 - Stock all SKU items of a RO

```plantuml
actor Clerk
participant EzWh
note over EzWh: Includes GUI and API interface
participant Warehouse
note over Warehouse : Includes DatabaseHelper
participant SKUItem
participant RestockOrder
participant SKU
participant Position

Clerk -> EzWh : Selects Restock Order ID ROID, RFID list RL
activate EzWh
EzWh -> Warehouse : for R in RL do getSKUItemByRFID(R)
activate Warehouse
Warehouse -> SKUItem : getSKUId()
activate SKUItem
SKUItem --> Warehouse : SKUID
deactivate SKUItem

Warehouse -> Warehouse : RO = getRestockOrderById(ROID)
Warehouse -> RestockOrder : getQuantityBySKUid(SKUID)
activate RestockOrder
RestockOrder --> Warehouse : Quantity Q
deactivate RestockOrder

Warehouse -> Warehouse : S = getSKUbyId(SKUID)
Warehouse -> SKU : addQuantity(Q)
activate SKU
SKU --> Warehouse : Done
deactivate SKU

Warehouse -> SKU : getWeight()
activate SKU
SKU --> Warehouse : Integer W
deactivate SKU
Warehouse -> SKU : getVolume()
activate SKU
SKU --> Warehouse : Integer V
deactivate SKU
Warehouse -> SKU : getPosition()
activate SKU
SKU --> Warehouse : Position P
deactivate SKU

Warehouse -> Position : addOccupiedWeight(W*Q)
activate Position
Position --> Warehouse : Done
deactivate Position
Warehouse -> Position : addOccupiedVolume(V*Q)
activate Position
Position --> Warehouse : Done
deactivate Position
Warehouse --> EzWh : Done
deactivate Warehouse

EzWh -> Warehouse : updateRestockOrderState(ROID, COMPLETED)
activate Warehouse
Warehouse -> RestockOrder : setState(COMPLETED)
activate RestockOrder
RestockOrder --> Warehouse : Done
deactivate RestockOrder

Warehouse --> EzWh : Done
deactivate Warehouse

EzWh --> Clerk : Done
deactivate EzWh
```

## Scenario 6.1 - Return order of SKU items that failed quality test

```plantuml
actor Manager
participant EzWh
note over EzWh: Includes GUI and API interface
participant Warehouse
participant RestockOrder

Manager -> EzWh : Selects Restock Order ID ROID,\nReturn Date D, Return Order ID REOID
EzWh -> Warehouse : getRestockOrderById(ROID)
activate Warehouse
Warehouse -> RestockOrder : getSkuItems()
activate RestockOrder
RestockOrder --> Warehouse : List<SKUItems>
deactivate RestockOrder

Warehouse -> Warehouse : L = Filter SKUItems with failed test results
Warehouse -> Warehouse : createReturnOrder(D, L, ROID)
Warehouse -> Warehouse : generate REOID
Warehouse -> ReturnOrder : new ReturnOrder(REOID, D, ROID)
activate ReturnOrder
ReturnOrder --> Warehouse : REO
deactivate ReturnOrder
Warehouse -> ReturnOrder : for I in L do REO.addSKUItem(I)
activate ReturnOrder
ReturnOrder --> Warehouse : Done
deactivate ReturnOrder

Warehouse --> EzWh : Done
deactivate Warehouse
EzWh --> Manager : Done
```

## Scenario 7.1 - Login

```plantuml
actor       User            as U
participant ":EzWh"         as ezwh
participant ":Warehouse"    as wh
participant ":User"         as user
participant ":DatabaseHelper"   as db

U -> ezwh: Selects userID id, password p
activate ezwh
ezwh -> wh: getUserbyId(id)
activate wh
wh -> db: loadUser()
activate db
db --> wh: users : Map <String,User>
deactivate db
wh --> ezwh : user : User
deactivate wh
alt User exists
    ezwh -> user: User::getPassword(user)
    activate user
    user --> ezwh: userPass : String
    deactivate user
    alt p == userPass
    ezwh -> user: User::getRole(user)
    activate user
    user --> ezwh: userRole : UserRole
    deactivate user
    group Role [ADMINISTRATOR]
        ezwh -> wh: administratorSession(id, p)
        activate wh
    else MANAGER
        ezwh -> wh: managerSession(id, p)
    else CLERK
        ezwh -> wh: clerkSession(id, p)
    else QUALITY CHECKER
        ezwh -> wh: qualityEmployeeSession(id, p)
    else DELIVERY
        ezwh -> wh: deliveryEmployeeSession(id, p)
    else CUSTOMER
        ezwh -> wh: customerSession(id, p)
    else SUPPLIER
        ezwh -> wh: supplierSession(id, p)
        end
    wh --> ezwh: session: UserSession
    deactivate wh
    ezwh --> U: session: UserSession
    else p != userPass
        ezwh --> U: throws InvalidPasswordException
        end
else User doesn't exists
    ezwh --> U: throws NullUserException
    end
```

## Scenario 7.2 - Logout

```plantuml
actor       User            as U
participant ":EzWh"         as ezwh
participant ":Warehouse"    as wh
participant ":DatabaseHelper"   as db

U -> ezwh: Selects user U
activate ezwh
ezwh -> wh: logout()
activate wh
wh -> db: updateUser(U)
activate db
db --> wh: void
deactivate db
wh --> ezwh : void
deactivate wh
ezwh --> U: void
```

## Scenario 9.1 - Internal Order IO accepted

```plantuml
actor Manager
actor Customer
participant EzWh
note over EzWh: Includes GUI and API interface
participant Warehouse
note over Warehouse: Includes DatabaseHelper
participant InternalOrder
Customer -> EzWh: IO started
activate Warehouse
Customer -> EzWh: Adds SKU
EzWh -> Warehouse: initInternalOrder(id, date, customerId, from, priority)
activate InternalOrder
Warehouse -> InternalOrder: addSKUToInternalOrder(InternalOrderId, itemId, quantity)
Customer -> EzWh: IO confirmed
EzWh -> Warehouse: updateSKU(SKU)
EzWh -> Warehouse: updatePosition(Object : Position)
EzWh -> Warehouse: setInternalOrderIssued(id)
Warehouse --> EzWh: Done
deactivate Warehouse
EzWh -> InternalOrder: setState(ISSUED)
Manager -> EzWh: IO accepted
EzWh -> InternalOrder: setState(ACCEPTED)
InternalOrder --> EzWh: Done
deactivate InternalOrder
EzWh --> Manager: Done
EzWh --> Customer: Done
```

## Scenario 10.1 - Internal Order IO Completed

```plantuml
actor DeliveryEmployee as D
participant EzWh
note over EzWh: Includes GUI and API interface
participant Warehouse
participant InternalOrder
participant SKU
participant SKUItem
D -> EzWh: Views Internal Orders
activate Warehouse
EzWh -> Warehouse: GetInternalOrder()
Warehouse --> EzWh: Collection<InternalOrder>
D -> EzWh: IO selected
EzWh -> Warehouse: getInternalOrderById(id)
Warehouse --> EzWh: InternalOrder
EzWh -> Warehouse: getInternalOrderSKUs(id)
Warehouse --> EzWh: Collection<SKU>
deactivate Warehouse
activate SKU
EzWh -> SKU: getSkuItemsID() :
SKU --> EzWh: Collection<String>
deactivate SKU
activate SKUItem
EzWh -> SKUItem: getRFID()
SKUItem --> EzWh: RFID
D -> EzWh: SKU items collected
EzWh -> SKUItem: setAvailable(false)
SKUItem --> EzWh: Done
deactivate SKUItem
activate InternalOrder
EzWh -> InternalOrder: setState(COMPLETED)
InternalOrder --> EzWh: Done
deactivate InternalOrder
EzWh --> D: Done
```

## Scenario 11.1 - Create Item I

```plantuml
actor Supplier
participant EzWh
note over EzWh: Includes GUI and API interface
participant Warehouse
Supplier -> EzWh: Inserts description, SKUid and price
EzWh --> Supplier: Data preview
Supplier -> EzWh: Confirms data
activate Warehouse
EzWh -> Warehouse: createItem(id, description, price, SKUid, supplierID)
Warehouse --> EzWh: Done
deactivate Warehouse
EzWh --> Supplier: Done
```

## Scenario 12.1 - Create test description

```plantuml
actor Manager as M
participant EzWh
note over EzWh: Includes GUI and API interface
participant Warehouse
participant TestDescriptor
M -> EzWh: Defines name and procedure description
M -> EzWh: Selects S
EzWh --> M: Data preview
M -> EzWh: Confirms data
activate Warehouse
EzWh -> Warehouse: createTestDescriptor(id, name, description)
Warehouse --> EzWh: Done
EzWh -> Warehouse: getTestDescriptorById(id)
Warehouse --> EzWh: TestDescriptor
deactivate Warehouse
activate TestDescriptor
EzWh -> TestDescriptor: setIdSKU(newIdSKU)
TestDescriptor --> EzWh: Done
deactivate TestDescriptor
EzWh --> M: Done
```
